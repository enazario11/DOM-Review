---
title: "literature coding explore"
author: "Emily Nazario | UC Santa Cruz | enazario'@'ucsc.edu"
date: "`r Sys.Date()`"
format:
 html: 
  self-contained: true
editor: visual
toc: TRUE
toc-title: "On this page"
theme: yeti
fontcolor: "#134f5c"
---

```{r}
#| include: false
#| echo: false
#| warning: false
#| message: false

library(tidyverse)
library(tidyquant)
library(here)
library(kableExtra)
library(waffle)
library(extrafont)
library(hrbrthemes)
library(patchwork)

code_freq <- read.csv(here("data/code_freq_032224.csv"))
codes_vars <- read.csv(here("data/code_w_vars_032224.csv"))
keywords <- read.csv(here("data/keywords_032224.csv"))
occur_all <- read.csv(here("data/code_configs_all_032224.csv"))
occur_br <- read.csv(here("data/code_configs_bridges_032224.csv"))
occur_ba <- read.csv(here("data/code_configs_barriers_032224.csv"))

#change codes to new names 
  #code_freq
    #sp br  
code_freq$code_cat <- replace(code_freq$code_cat, code_freq$code_cat == "Species bridge", "Ecological bridge")
code_freq$code_cat <- replace(code_freq$code_cat, code_freq$code_cat == "Species barrier", "Ecological barrier")
code_freq$code_name <- replace(code_freq$code_name, code_freq$code_name == "Limited Prey Resources", "TargetÂ species is a prey specialist")
code_freq$code_name <- replace(code_freq$code_name, code_freq$code_name == "Fine Scale management required", "Fine-scale management appropriate for target species")
code_freq$code_name <- replace(code_freq$code_name, code_freq$code_name == "Migratory and/or dynamic range", "Highly mobile target species")
code_freq$code_name[code_freq$code_cat == "Ecological bridge" & code_freq$code_name == "Climate change"] <- "Expected climate change induced range shifts"
code_freq$code_name <- replace(code_freq$code_name, code_freq$code_name == "Known Species Nat History", "Life history information available for target species")
code_freq$code_name <- replace(code_freq$code_name, code_freq$code_name == "Distinct Habitat between target and non-target species", "Distinct habitat preferences among species in system")

    #data br
code_freq$code_name <- replace(code_freq$code_name, code_freq$code_name == "Advances in Tech", "Access to advanced technology and techniques")
code_freq$code_name <- replace(code_freq$code_name, code_freq$code_name == "Scale appropriate for system", "Management scale aligns with system needs")
code_freq$code_name <- replace(code_freq$code_name, code_freq$code_name == "Open-Access Public Data", "Data transparency and accessibility")
code_freq$code_name <- replace(code_freq$code_name, code_freq$code_name == "Availability for species", "Target species data availability")
code_freq$code_name <- replace(code_freq$code_name, code_freq$code_name == "Stakeholder/Anthropogenic Data Access", "Resource use data availability")
code_freq$code_name <- replace(code_freq$code_name, code_freq$code_name == "Enviro Access", "Abiotic data availability")

    #soc br
code_freq$code_name <- replace(code_freq$code_name, code_freq$code_name == "Open Communication or Co-Mngmt in place", "Co-management and communication")
code_freq$code_name <- replace(code_freq$code_name, code_freq$code_name == "Adoption Interests & Incentives", "Adoption incentives for end users")
code_freq$code_name <- replace(code_freq$code_name, code_freq$code_name == "Pre-existing regulation & management institutions", "Pre-existing regulation and management institutions")
code_freq$code_name <- replace(code_freq$code_name, code_freq$code_name == "DOM implementation feasible (Socio-econ)", "Feasibility")
code_freq$code_name <- replace(code_freq$code_name, code_freq$code_name == "Resource Availability (economical)", "Resource availability")

  #sp ba 
code_freq$code_cat[code_freq$code_name == "Model Abuse"] <- "Data barrier"
code_freq$code_name <- replace(code_freq$code_name, code_freq$code_name == "Switch to multi-species mngmnt", "Need for multispecies management")

  #data ba
code_freq$code_name <- replace(code_freq$code_name, code_freq$code_name == "Gaps and Accuracy", "Gaps and inaccuracy")
code_freq$code_name <- replace(code_freq$code_name, code_freq$code_name == "Model Abuse", "Model abuse")
code_freq$code_name <- replace(code_freq$code_name, code_freq$code_name == "Mismatch in scale", "Management scales do not align with system needs")
code_freq$code_cat[code_freq$code_name == "Climate change"] <- "Data barrier"
code_freq$code_name <- replace(code_freq$code_name, code_freq$code_name == "Climate change", "Climate change adding uncertainty to target species habitat use")

  #soc ba
code_freq$code_name <- replace(code_freq$code_name, code_freq$code_name == "Unintended consequences", "Indirect socioeconomic consequences")
code_freq$code_name <- replace(code_freq$code_name, code_freq$code_name == "Political permanence", "Lack of political administration permanence")
code_freq$code_name <- replace(code_freq$code_name, code_freq$code_name == "Communication & Distribution", "Poor communication and outreach")
code_freq$code_name <- replace(code_freq$code_name, code_freq$code_name == "Recipient participation", "Poor program implementation")
code_freq$code_name <- replace(code_freq$code_name, code_freq$code_name == "Cost", "Implementation costs")

```

## Selecting the literature that was included in this systematic review

In June 2022 a systematic search was completed using Web of Science to identify articles that mentioned factors that either contributed to "successful" implementation of dynamic ocean management (DOM), hereafter referred to as a "bridge". Literature that discussed factors that would need to be addressed or considered prior to effective implementation of dynamic management approaches or tools were also included, hereafter referred to as a "barrier". In this systematic review, we coded bridges and barriers that were related to DOM voluntary programs and/or enforced regulations, as well as those that were related to tool development (e.g., species spatial modeling tools such as EcoCast) that support dynamic management approaches.

During the initial search, the following table of primary and secondary terms were used:

| Primary term               | Secondary term |
|----------------------------|----------------|
| Dynamic ocean management   | Success        |
| Dynamic spatial management | Efficiency     |
| Adaptive management        | Obstacles      |
| Dynamic closures           | Limitations    |
| Bycatch reduction          |                |
| Habitat preference         |                |

A search was completed in Web of Science for each combination of primary and secondary terms. Works from the primary (i.e., peer reviewed journals) and grey (e.g., theses, book chapters) were included, and this initial search resulted in 1,351 articles. The abstracts for each of these documents were scanned for relevance, and the inclusion of the terms 'dynamic' or 'adaptive' management were confirmed. From this cut, a remaining 127 articles were saved. An additional search through the NOAA Institutional Repository and Federal Register was also completed. Here, documents such as policy reports and planning documents were selected. This search resulted in 795 documents. The abstracts or content summaries for each of these documents were scanned for relevance, and 10 articles were saved for a full read through to determine final inclusion. Inclusion and exclusion criteria for both queries are described here:

| Inclusion                                                                                                                                                                                                  | Exclusion                                                                                                                                                                                                    |
|------------------------------------|:-----------------------------------|
| All cases where adaptive or near-real time forms of management or tools that support this form of management were discussed, even if the specific term 'Dynamic Ocean Management' was not explicitly used. | The term 'DOM' was mentioned, or even recommended, but there was no discussion as to why (e.g. SDM studies that suggest DOM applications as a next step for their model)                                     |
| All cases where near real-time SDM tools or fleet-wide communication to avoid negative species interactions.                                                                                               | Articles that involved changes or updates to environmental data stores or remote sensing tools used for developing SDM tools to support DOM, but DOM was not specifically applied, recommended, or reviewed. |

The final list of included works consisted of 137 documents. Each of these were fully read by two reviewers and went through a final pass for determining inclusion. Additional snowball sampling was performed to identify and include articles that were referenced in this list. The abstracts of these referenced articles were read and their inclusion was determined. Lastly, the search ended in August 2023 and articles or documents published after this date were not included in this review. The final list of works analyzed for the review included 110 articles (i.e., primary literature, student theses, policy reports, textbook chapters).

## Coding the bridges and barriers as identified in the literature

Two reviewers went through each of the 110 articles to identify pieces of text that were related to DOM bridges that were linked to the approaches success or were used as justification when systems recommended its adoption. The reviewers also identified the barriers that hindered the efficacy of DOM or must be considered prior to it's broader application. Through this effort, 19 "bridge" and 10 "barrier" categories were determined. For both the bridge and barrier code categories, three larger "umbrella" groups were established: species, social, and data. A table of the full list of codes/themes are depicted here. Please note that this is a draft of codes, and thus we are happy to modify the terminology throughout the study review process.

::: panel-tabset
### Bridges

```{r}
#| echo: false
#| message: false
#| warning: false

bri_codes <- code_freq %>% 
  filter(bridge_barr == "Bridge") %>% 
  subset(select = -c(total, bridge_barr))

colnames(bri_codes) <- c("Code category", "Code label")

bri_codes %>%
  kbl() %>%
  kable_styling()
```

### Barriers

```{r}
#| echo: false
#| message: false
#| warning: false

bar_codes <- code_freq %>% 
  filter(bridge_barr == "Barrier") %>% 
  subset(select = -c(total, bridge_barr))

colnames(bar_codes) <- c("Code category", "Code label")

bar_codes %>%
  kbl() %>%
  kable_styling()
```
:::

## Visualizing the bridges and barrier codes from the literature

Below is a first attempt at how to visualize some of the data collected from this review. This first section represents general information about the articles selected for this review (e.g., study location, fisheries or shipping channels involved, species for which the tool or management program was established for).

### Study information

::: panel-tabset
#### Study regions

```{r}
#| echo: false
#| message: false
#| warning: false
#| fig-width: 7
#| fig-height: 7

codes_vars$broad_location <- as.factor(codes_vars$broad_location)
codes_LU <- codes_vars[!duplicated(codes_vars$Lit_unit), ]
reg_s <- codes_LU %>%
  group_by(broad_location) %>%
  filter(broad_location != "NA" & broad_location != "Europe and United States") %>%
  summarise(count = n()) %>%
  ungroup() %>%
  mutate(perc = count/sum(count)*100) 


reg_bar <- ggplot(reg_s) +
  geom_bar(aes(x = perc, y = reorder(broad_location, perc)), fill = "dodgerblue4", width = 0.6, stat = "identity")+
  scale_x_continuous(position = "top", 
                     expand = c(0,0), 
                     limits = c(0, 48))+
  scale_y_discrete(expand = expansion(add = c(0.5,0.5))) + 
  theme(
    # Set background color to white
    panel.background = element_rect(fill = "white"),
    # Set the color and the width of the grid lines for the horizontal axis
    panel.grid.major.x = element_line(color = "#A8BAC4", size = 0.3),
    # Remove tick marks by setting their length to 0
    axis.ticks.length = unit(0, "mm"),
    # Remove the title for both axes
    axis.title = element_blank(),
    # Only left line of the vertical axis is painted in black
    axis.line.y.left = element_line(color = "black"),
    # Remove labels from the vertical axis
    axis.text.y = element_blank(),
    # But customize labels for the horizontal axis
    axis.text.x = element_text(family = "Econ Sans Cnd", size = 12)) + 
  geom_text(aes(x = perc, y = broad_location, label = broad_location),
    hjust = 0,
    nudge_x = 0.3,
    colour = "dodgerblue4",
    family = "Econ Sans Cnd",
    size = 3.5)+
  labs(subtitle = "Percent of sum from all articles (%)") + 
  theme(plot.subtitle = element_text(
      family = "Econ Sans Cnd",
      size = 13)
  )

reg_bar
```

#### Study fisheries and shipping channels

```{r}
#| echo: false
#| message: false
#| warning: false
#| fig-height: 10
#| fig-width: 10
fsh_shp <- codes_LU %>%
  gather(col, fsh_shp, fishery_or_channel1:fishery_or_channel4) %>%
  subset(select = fsh_shp)


fsh_shp_s <- fsh_shp %>%
  group_by(fsh_shp) %>%
  filter(fsh_shp != "NA") %>%
  summarise(count = n()) %>%
  ungroup() %>%
  mutate(perc = count/sum(count)*100) 


fsh_shp_bar <- ggplot(fsh_shp_s) +
  geom_bar(aes(x = perc, y = reorder(fsh_shp, perc)), fill = "dodgerblue4", width = 0.6, stat = "identity")+
  scale_x_continuous(position = "top", 
                     expand = c(0,0), 
                     limits = c(0, 14))+
  scale_y_discrete(expand = expansion(add = c(0.5,0.5))) + 
  theme(
    # Set background color to white
    panel.background = element_rect(fill = "white"),
    # Set the color and the width of the grid lines for the horizontal axis
    panel.grid.major.x = element_line(color = "#A8BAC4", size = 0.3),
    # Remove tick marks by setting their length to 0
    axis.ticks.length = unit(0, "mm"),
    # Remove the title for both axes
    axis.title = element_blank(),
    # Only left line of the vertical axis is painted in black
    axis.line.y.left = element_line(color = "black"),
    # Remove labels from the vertical axis
    axis.text.y = element_blank(),
    # But customize labels for the horizontal axis
    axis.text.x = element_text(family = "Econ Sans Cnd", size = 15)) + 
  geom_text(aes(x = perc, y = fsh_shp, label = fsh_shp),
    hjust = 0,
    nudge_x = 0.3,
    colour = "dodgerblue4",
    family = "Econ Sans Cnd",
    size = 5)+
  labs(subtitle = "Percent of sum from all articles (%)") + 
  theme(plot.subtitle = element_text(
      family = "Econ Sans Cnd",
      size = 16)
  )

fsh_shp_bar
```

#### Study taxa

```{r}
#| echo: false
#| message: false
#| warning: false
#| fig-width: 7
#| fig-height: 7

species <- codes_LU %>%
  gather(col, taxa, focal_taxa1:focal_taxa3) %>%
  subset(select = taxa)

spp_s <- species %>%
  group_by(taxa) %>%
  filter(taxa != "NA" & taxa != "Marine mammals") %>%
  summarise(count = n()) %>%
  ungroup() %>%
  mutate(perc = count/sum(count)*100) 

taxa_bar <- ggplot(spp_s) +
  geom_bar(aes(x = perc, y = reorder(taxa, perc)), fill = "dodgerblue4", width = 0.6, stat = "identity")+
  scale_x_continuous(position = "top", 
                     expand = c(0,0), 
                     limits = c(0, 23))+
  scale_y_discrete(expand = expansion(add = c(0.5,0.5))) + 
  theme(
    # Set background color to white
    panel.background = element_rect(fill = "white"),
    # Set the color and the width of the grid lines for the horizontal axis
    panel.grid.major.x = element_line(color = "#A8BAC4", size = 0.3),
    # Remove tick marks by setting their length to 0
    axis.ticks.length = unit(0, "mm"),
    # Remove the title for both axes
    axis.title = element_blank(),
    # Only left line of the vertical axis is painted in black
    axis.line.y.left = element_line(color = "black"),
    # Remove labels from the vertical axis
    axis.text.y = element_blank(),
    # But customize labels for the horizontal axis
    axis.text.x = element_text(family = "Econ Sans Cnd", size = 12)) + 
  geom_text(aes(x = perc, y = taxa, label = taxa),
    hjust = 0,
    nudge_x = 0.3,
    colour = "dodgerblue4",
    family = "Econ Sans Cnd",
    size = 3.5)+
  labs(subtitle = "Percent of sum from all articles (%)") + 
  theme(plot.subtitle = element_text(
      family = "Econ Sans Cnd",
      size = 13)
  )

taxa_bar
```

#### Study species

```{r}
#| echo: false
#| message: false
#| warning: false
#| fig-width: 7
#| fig-height: 12

species_Gs <- codes_LU %>%
  gather(col, sp_name, species1:species16) %>%
  subset(select = sp_name)

spp_Gs_s <- species_Gs %>%
  group_by(sp_name) %>%
  filter(sp_name != "NA") %>%
  summarise(count = n()) %>%
  ungroup() %>%
  mutate(perc = count/sum(count)*100) 

sp_bar <- ggplot(spp_Gs_s) +
  geom_bar(aes(x = perc, y = reorder(sp_name, perc)), fill = "dodgerblue4", width = 0.6, stat = "identity")+
  scale_x_continuous(position = "top", 
                     expand = c(0,0), 
                     limits = c(0, 23))+
  scale_y_discrete(expand = expansion(add = c(0.5,0.5))) + 
  theme(
    # Set background color to white
    panel.background = element_rect(fill = "white"),
    # Set the color and the width of the grid lines for the horizontal axis
    panel.grid.major.x = element_line(color = "#A8BAC4", size = 0.3),
    # Remove tick marks by setting their length to 0
    axis.ticks.length = unit(0, "mm"),
    # Remove the title for both axes
    axis.title = element_blank(),
    # Only left line of the vertical axis is painted in black
    axis.line.y.left = element_line(color = "black"),
    # Remove labels from the vertical axis
    axis.text.y = element_blank(),
    # But customize labels for the horizontal axis
    axis.text.x = element_text(family = "Econ Sans Cnd", size = 12)) + 
  geom_text(aes(x = perc, y = sp_name, label = sp_name),
    hjust = 0,
    nudge_x = 0.3,
    colour = "dodgerblue4",
    family = "Econ Sans Cnd",
    size = 3.5)+
  labs(subtitle = "Percent of sum from all articles (%)") + 
  theme(plot.subtitle = element_text(
      family = "Econ Sans Cnd",
      size = 13)
  )

sp_bar
```

#### Conservation problem being addressed

```{r}
#| echo: false
#| message: false
#| warning: false
#| fig-width: 7
#| fig-height: 7

consv <- codes_LU %>%
  gather(col, consv_topic, reason1:reason3) %>%
  subset(select = consv_topic)

consv_s <- consv %>%
  group_by(consv_topic) %>%
  filter(consv_topic != "NA") %>%
  summarise(count = n()) %>%
  ungroup() %>%
  mutate(perc = count/sum(count)*100) 

consv_bar <- ggplot(consv_s) +
  geom_bar(aes(x = perc, y = reorder(consv_topic, perc)), fill = "dodgerblue4", width = 0.6, stat = "identity")+
  scale_x_continuous(position = "top", 
                     expand = c(0,0), 
                     limits = c(0, 18))+
  scale_y_discrete(expand = expansion(add = c(0,0))) + 
  theme(
    # Set background color to white
    panel.background = element_rect(fill = "white"),
    # Set the color and the width of the grid lines for the horizontal axis
    panel.grid.major.x = element_line(color = "#A8BAC4", size = 0.3),
    # Remove tick marks by setting their length to 0
    axis.ticks.length = unit(0, "mm"),
    # Remove the title for both axes
    axis.title = element_blank(),
    # Only left line of the vertical axis is painted in black
    axis.line.y.left = element_line(color = "black"),
    # Remove labels from the vertical axis
    axis.text.y = element_blank(),
    # But customize labels for the horizontal axis
    axis.text.x = element_text(family = "Econ Sans Cnd", size = 12)) + 
  geom_text(aes(x = perc, y = consv_topic, label = consv_topic),
    hjust = 0,
    nudge_x = 0.3,
    colour = "dodgerblue4",
    family = "Econ Sans Cnd",
    size = 3.5)+
  labs(subtitle = "Percent of sum from all articles (%)") + 
  theme(plot.subtitle = element_text(
      family = "Econ Sans Cnd",
      size = 13)
  )

consv_bar
```
:::

### Code appearance frequencies across articles (n = 109)

```{r}
#| echo: false
#| message: false
#| warning: false
#| fig-width: 10
#| fig-height: 7
#| fig-align: center

codes_vars2 = codes_vars
colnames(codes_vars2) <- gsub(x = colnames(codes_vars2), pattern = "\\.", replacement = " ")
  

  #calculate frequency of bridges vs. barriers being mentioned in articles -- need to add biotic and abiotic indicators cols
code_freq_new <- codes_vars2 %>%
  mutate(br_pos = as.numeric(if_any(c(33:48, 59:61), ~. == 1)), 
         ba_pos = as.numeric(if_any(49:58, ~. == 1)),
         br_dat = as.numeric(if_any(c("Management scale aligns with system needs", "Target species data availability", "Access to advanced technology and techniques", "Data transparency and accessibility", "Abiotic data availability", "Resource use data availability"), ~. == 1)), 
         br_eco = as.numeric(if_any(c("Expected climate change induced range shifts", "Distinct habitat preferences among species in system", "Highly mobile target species", "Target species is a prey specialist", "Life history information available for target species", "Fine scale management appropriate for target species", "Biotic indicators of target species presence", "Abiotic indicators of target species presence"), ~. == 1)), 
         br_soc = as.numeric(if_any(c("Resource availability", "Pre existing regulation and management institutions", "Adoption incentives for end users", "Feasibility", "Co management and communication"), ~. == 1)), 
         ba_dat = as.numeric(if_any(c("Implementation costs", "Gaps and inaccuracy", "Management scales do not align with system needs", "Model abuse", "Climate change adding uncertainty to target species habitat use"), ~. == 1)), 
         ba_eco = as.numeric(if_any(c("Need for multispecies management"), ~. == 1)), 
         ba_soc = as.numeric(if_any(c("Indirect socioeconomic consequences", "Lack of political administration permanence", "Poor communication and outreach", "Poor program implementation"), ~. == 1)))

brba_sum <- code_freq_new %>%
  summarise(n_br = sum(br_pos), freq_br = n_br/109,
            n_ba = sum(ba_pos), freq_ba = n_ba/109,
            n_br_e = sum(br_eco), freq_br_e = n_br_e/109,
            n_br_d = sum(br_dat), freq_br_d = n_br_d/109,
            n_br_s = sum(br_soc), freq_br_s = n_br_s/109,
            n_ba_e = sum(ba_eco), freq_ba_e = n_ba_e/109,
            n_ba_d = sum(ba_dat), freq_ba_d = n_ba_d/109,
            n_ba_s = sum(ba_soc), freq_ba_s = n_ba_s/109) %>%
  gather(br_ba, value, c(2,4,6, 8, 10, 12, 14, 16)) %>%
  subset(select = c(br_ba, value)) %>%
  mutate(percent_label = scales::percent(value, accuracy = 1), 
         percent = if_else(br_ba == "freq_ba" | br_ba == "freq_ba_e" | br_ba == "freq_ba_d" | br_ba == "freq_ba_s", -value, value),
         code_level = if_else(br_ba %in% c("freq_ba", "freq_br"), "Overall bridge or barrier", 
                              if_else(br_ba %in% c("freq_ba_e", "freq_br_e"), "Ecological bridge or barrier", 
                              if_else(br_ba %in% c("freq_ba_d", "freq_br_d"), "Data bridge or barrier",
                              if_else(br_ba %in% c("freq_ba_s", "freq_br_s"), "Social bridge or barrier", NA)))),
         code_brba = if_else(br_ba %in% c("freq_br", "freq_br_e", "freq_br_s", "freq_br_d"), "bridge", "barrier"),
         alpha_brba = if_else(br_ba %in% c("freq_br_e", "freq_br_s", "freq_br_d", "freq_ba_e", "freq_ba_s", "freq_ba_d"), "alpha", "no_alpha")) %>%
  group_by(code_level)

brba_sum$code_level <- factor(brba_sum$code_level, levels = c("Social bridge or barrier", "Ecological bridge or barrier", "Data bridge or barrier", "Overall bridge or barrier"))

ggplot(brba_sum, aes(x = code_level, 
             y = percent,
             fill = code_brba)) +
  geom_col(width = 0.7) +
  geom_text(aes(label = percent_label),
            position = position_stack(vjust = 0.5),
            color = "black", 
            size = 5) +
  ylim(-0.7,1)+
  coord_flip() +
  scale_x_discrete() +
  scale_fill_manual(values = c("lightskyblue3", "goldenrod"), labels = c("Barrier frequency", "Bridge frequency")) +
  theme_minimal() +
  theme(axis.title.y = element_blank(),
        axis.title.x = element_blank(),
        axis.text.x =element_blank(),
        axis.text.y = element_text(size = 20, color = "black"),
        panel.grid = element_blank(),
        legend.position = c(-0.21, 0.99),
        legend.text = element_text(size = 16, color = "black"),
        strip.text.y.right = element_text(angle = 0, size = 16)) +
  geom_hline(yintercept = 0.0, linewidth = 1) + 
  labs(fill = "")+ 
  guides(fill = guide_legend(nrow = 1))
```

### Codes vs. study information

### Code co-occurrence themes

::: panel-tabset
#### All codes

#### Bridges codes

#### Barriers codes
:::

### Keywords and literature type

::: panel-tabset
#### Keywords

#### Literature type
:::
